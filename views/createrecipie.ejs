<!-- createRecipe.ejs -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Create Recipe</title>
</head>
<body>
  <h1>Create Recipe</h1>

  <form id="createRecipeForm" enctype="multipart/form-data">
    <div>
      <label for="title">Title:</label>
      <input type="text" id="title" name="title" required>
    </div>
    <div>
      <label for="category">Category:</label>
      <select id="category" name="category" required>
        <% categories.forEach(category => { %>
          <option value="<%= category._id %>"><%= category.name %></option>
        <% }) %>
      </select>
    </div>
    <div>
      <label for="servingSize">Serving Size:</label>
      <input type="text" id="servingSize" name="servingSize" required>
    </div>
    <div>
      <label for="preparationTime">Preparation Time:</label>
      <input type="text" id="preparationTime" name="preparationTime" required>
    </div>
    <div>
      <label for="ingredients">Ingredients:</label>
      <textarea id="ingredients" name="ingredients" rows="4" required></textarea>
    </div>
    <div>
      <label for="description">description:</label>
      <textarea id="description" name="description" rows="8" required></textarea>
    </div>
    <div>
      <label for="instructions">Instructions:</label>
      <textarea id="instructions" name="instructions" rows="8" required></textarea>
    </div>
    <div>
      <label for="image">Image:</label>
      <input type="file" id="image" name="image" accept="image/*" required>
    </div>
    
    <button type="submit">Upload Recipe</button>
  </form>
  <script>
    document.getElementById('createRecipeForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const token = localStorage.getItem('token');
      const title = document.getElementById('title').value;
      const category = document.getElementById('category').value;
      const servingSize = document.getElementById('servingSize').value;
      const preparationTime = document.getElementById('preparationTime').value;
      const ingredients = document.getElementById('ingredients').value;
      const instructions = document.getElementById('instructions').value;
      const description = document.getElementById('description').value;
      const image = document.getElementById('image').files[0];

      try {
        const formData = new FormData();
        formData.append('title', title);
        formData.append('category', category);
        formData.append('servingSize', servingSize);
        formData.append('preparationTime', preparationTime);
        formData.append('ingredients', ingredients);
        formData.append('instructions', instructions);
        formData.append('description', description);
        formData.append('image', image);

        const response = await fetch('/recipes', {
          method: 'POST',
          body: formData,
          headers: {
            'Authorization': `Bearer ${token}`,
          },
        });

        if (response.ok) {
          window.location.href = '/dashboard'; // Redirect to dashboard upon successful recipe creation
        } else {
          const text = await response.text();
          console.error(text); // Log error message as plain text
        }
      } catch (error) {
        console.error(error);
      }
    });
  </script>
</body>
</html>
